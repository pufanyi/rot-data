# ä»»åŠ¡æ¿ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### æ–¹æ³•ä¸€ï¼šè¿è¡Œæ¼”ç¤ºï¼ˆæ¨èæ–°æ‰‹ï¼‰

æœ€ç®€å•çš„æ–¹å¼æ˜¯è¿è¡ŒåŒ…å« 441 ä¸ªæ¨¡æ‹Ÿä»»åŠ¡çš„æ¼”ç¤ºï¼š

```bash
# ä½¿ç”¨å¿«æ·è„šæœ¬
./start_taskboard.sh

# æˆ–ç›´æ¥è¿è¡Œ
uv run python examples/taskboard_demo.py
```

ç„¶ååœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `http://localhost:8765` å³å¯çœ‹åˆ°ä»»åŠ¡æ¿ç•Œé¢ã€‚

### æ–¹æ³•äºŒï¼šä¸å®é™…æ•°æ®åŠ è½½é›†æˆ

å¦‚æœä½ æƒ³åœ¨å®é™…çš„æ•°æ®åŠ è½½è¿‡ç¨‹ä¸­ä½¿ç”¨ä»»åŠ¡æ¿ï¼š

```python
from rot_data.dataloader.co3d import CO3DDataLoader
from rot_data.taskboard.server import start_server
import time

# 1. å¯åŠ¨ä»»åŠ¡æ¿æœåŠ¡å™¨
server = start_server(host="0.0.0.0", port=8765)
print("ä»»åŠ¡æ¿: http://localhost:8765")
time.sleep(2)  # ç­‰å¾…æœåŠ¡å™¨å¯åŠ¨

# 2. åˆ›å»ºæ•°æ®åŠ è½½å™¨å¹¶å¯ç”¨ä»»åŠ¡æ¿
loader = CO3DDataLoader(
    cache_dir="cache",
    num_threads=4,
    use_taskboard=True  # å…³é”®ï¼šå¯ç”¨ä»»åŠ¡æ¿
)

# 3. åŠ è½½æ•°æ®
for data in loader.load():
    # å¤„ç†æ•°æ®...
    pass
```

## ä»»åŠ¡æ¿ç•Œé¢è¯´æ˜

### é¡¶éƒ¨ç»Ÿè®¡é¢æ¿

æ˜¾ç¤ºä»¥ä¸‹ç»Ÿè®¡ä¿¡æ¯ï¼ˆå¸¦å½©è‰²æ¸å˜å¡ç‰‡ï¼‰ï¼š

- **æ€»ä»»åŠ¡æ•°**ï¼šæ‰€æœ‰ä»»åŠ¡çš„æ€»æ•°
- **å¾…å¤„ç†**ï¼šé»„è‰²ï¼Œç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡
- **è¿è¡Œä¸­**ï¼šè“è‰²ï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡
- **å·²å®Œæˆ**ï¼šç»¿è‰²ï¼ŒæˆåŠŸå®Œæˆçš„ä»»åŠ¡
- **å¤±è´¥**ï¼šçº¢è‰²ï¼Œæ‰§è¡Œå¤±è´¥çš„ä»»åŠ¡

### ä»»åŠ¡åˆ—è¡¨

æ¯ä¸ªä»»åŠ¡å¡ç‰‡æ˜¾ç¤ºï¼š

- **ä»»åŠ¡åç§°**ï¼šå¦‚ "apple - 000"
- **çŠ¶æ€æ ‡ç­¾**ï¼špending/running/completed/failed
- **è¿›åº¦æ¡**ï¼šæ˜¾ç¤ºå®Œæˆç™¾åˆ†æ¯”ï¼ˆä»…è¿è¡Œä¸­å’Œå·²å®Œæˆçš„ä»»åŠ¡ï¼‰
- **è¿›åº¦æ–‡æœ¬**ï¼šå¦‚ "50 / 100 (50.0%)"
- **å…ƒæ•°æ®**ï¼šä»»åŠ¡ IDã€å¼€å§‹æ—¶é—´ã€ç»“æŸæ—¶é—´
- **é”™è¯¯ä¿¡æ¯**ï¼šå¤±è´¥ä»»åŠ¡ä¼šæ˜¾ç¤ºé”™è¯¯è¯¦æƒ…

### è¿‡æ»¤æŒ‰é’®

ä½¿ç”¨é¡¶éƒ¨çš„è¿‡æ»¤æŒ‰é’®å¯ä»¥æŒ‰çŠ¶æ€ç­›é€‰ä»»åŠ¡ï¼š

- **All**ï¼šæ˜¾ç¤ºæ‰€æœ‰ä»»åŠ¡
- **Pending**ï¼šåªæ˜¾ç¤ºå¾…å¤„ç†çš„ä»»åŠ¡
- **Running**ï¼šåªæ˜¾ç¤ºæ­£åœ¨è¿è¡Œçš„ä»»åŠ¡
- **Completed**ï¼šåªæ˜¾ç¤ºå·²å®Œæˆçš„ä»»åŠ¡
- **Failed**ï¼šåªæ˜¾ç¤ºå¤±è´¥çš„ä»»åŠ¡

### è¿æ¥çŠ¶æ€

å³ä¸Šè§’æ˜¾ç¤º WebSocket è¿æ¥çŠ¶æ€ï¼š

- ğŸŸ¢ **Connected**ï¼šæ­£å¸¸è¿æ¥ï¼Œå®æ—¶æ›´æ–°
- ğŸ”´ **Disconnected**ï¼šè¿æ¥æ–­å¼€ï¼Œä¼šè‡ªåŠ¨é‡è¿

## åœ¨è‡ªå®šä¹‰ DataLoader ä¸­ä½¿ç”¨

å¦‚æœä½ æƒ³åœ¨è‡ªå·±çš„ DataLoader ä¸­é›†æˆä»»åŠ¡æ¿ï¼š

```python
from rot_data.dataloader.data import DataLoader
from rot_data.taskboard import get_task_board

class MyDataLoader(DataLoader):
    def __init__(self, use_taskboard: bool = False):
        self.use_taskboard = use_taskboard
        self.taskboard = get_task_board() if use_taskboard else None
    
    def load(self):
        jobs = self._collect_jobs()  # è·å–æ‰€æœ‰ä»»åŠ¡
        
        for idx, job in enumerate(jobs):
            # 1. æ·»åŠ ä»»åŠ¡
            task_id = f"job_{idx}"
            if self.taskboard:
                self.taskboard.add_task(
                    task_id=task_id,
                    name=f"Processing job {idx}",
                    total=100,  # å¦‚æœçŸ¥é“æ€»å·¥ä½œé‡
                    metadata={"job": job}
                )
            
            # 2. å¼€å§‹ä»»åŠ¡
            if self.taskboard:
                self.taskboard.start_task(task_id)
            
            try:
                # 3. æ‰§è¡Œä»»åŠ¡å¹¶æ›´æ–°è¿›åº¦
                for i in range(100):
                    # åšä¸€äº›å·¥ä½œ...
                    if self.taskboard:
                        self.taskboard.update_task(task_id, progress=i+1)
                    yield result
                
                # 4. å®Œæˆä»»åŠ¡
                if self.taskboard:
                    self.taskboard.complete_task(task_id)
            
            except Exception as e:
                # 5. æ ‡è®°ä»»åŠ¡å¤±è´¥
                if self.taskboard:
                    self.taskboard.fail_task(task_id, str(e))
                raise
```

## é…ç½®é€‰é¡¹

### æœåŠ¡å™¨é…ç½®

```python
from rot_data.taskboard.server import start_server

server = start_server(
    host="0.0.0.0",  # ç»‘å®šæ‰€æœ‰ç½‘ç»œæ¥å£ï¼ˆå…è®¸è¿œç¨‹è®¿é—®ï¼‰
    port=8765,       # æœåŠ¡å™¨ç«¯å£
)
```

### è¿œç¨‹è®¿é—®

å¦‚æœä½ åœ¨æœåŠ¡å™¨ä¸Šè¿è¡Œï¼Œå¯ä»¥é€šè¿‡ SSH ç«¯å£è½¬å‘è®¿é—®ä»»åŠ¡æ¿ï¼š

```bash
ssh -L 8765:localhost:8765 user@server
```

ç„¶ååœ¨æœ¬åœ°æµè§ˆå™¨è®¿é—® `http://localhost:8765`ã€‚

## æŠ€æœ¯å®ç°

### æ•°æ®æ”¶é›†æ¨¡å¼

å½“å¯ç”¨ä»»åŠ¡æ¿æ—¶ï¼Œæ•°æ®å¤„ç†æµç¨‹ä¼šæœ‰æ‰€ä¸åŒï¼š

- **ä¸ä½¿ç”¨ä»»åŠ¡æ¿**ï¼šä½¿ç”¨ `Dataset.from_generator` æµå¼å¤„ç†
- **ä½¿ç”¨ä»»åŠ¡æ¿**ï¼šå…ˆæ”¶é›†æ‰€æœ‰æ•°æ®åˆ°å†…å­˜ï¼Œç„¶åä½¿ç”¨ `Dataset.from_list` åˆ›å»ºæ•°æ®é›†

**åŸå› **ï¼š
- ä»»åŠ¡æ¿åŒ…å« WebSocket è¿æ¥å’Œè®¢é˜…è€…å›è°ƒ
- è¿™äº›å¯¹è±¡æ— æ³•è¢« pickle åºåˆ—åŒ–
- `Dataset.from_generator` ä¼šå°è¯•åºåˆ—åŒ– generator å‡½æ•°è¿›è¡Œå“ˆå¸Œ

**å½±å“**ï¼š
- âœ… æ•°æ®åŠ è½½ä»ç„¶æ˜¯å¤šçº¿ç¨‹å¹¶å‘çš„ï¼ˆç”± `--num-threads` æ§åˆ¶ï¼‰
- âœ… å®Œå…¨é¿å…äº†åºåˆ—åŒ–é—®é¢˜
- âš ï¸ éœ€è¦é¢å¤–çš„å†…å­˜æ¥å­˜å‚¨æ‰€æœ‰æ•°æ®é¡¹ï¼ˆé€šå¸¸ä¸æ˜¯é—®é¢˜ï¼‰

## å¸¸è§é—®é¢˜

### Q: ä»»åŠ¡æ¿æ˜¾ç¤º "Disconnected"ï¼Ÿ

**A:** æ£€æŸ¥ä»¥ä¸‹å‡ ç‚¹ï¼š

1. ç¡®è®¤æœåŠ¡å™¨æ˜¯å¦æ­£åœ¨è¿è¡Œ
2. æ£€æŸ¥ç«¯å£ 8765 æ˜¯å¦è¢«å ç”¨
3. æŸ¥çœ‹æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
4. é¡µé¢ä¼šè‡ªåŠ¨é‡è¿ï¼Œç¨ç­‰ç‰‡åˆ»

### Q: çœ‹ä¸åˆ°ä»»åŠ¡æ›´æ–°ï¼Ÿ

**A:** ç¡®ä¿ï¼š

1. æ•°æ®åŠ è½½å™¨å¯ç”¨äº† `use_taskboard=True`
2. WebSocket è¿æ¥çŠ¶æ€æ˜¾ç¤ºä¸º "Connected"
3. åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥

### Q: å¦‚ä½•æ›´æ”¹ç«¯å£ï¼Ÿ

**A:** ä¿®æ”¹ `start_server()` çš„ `port` å‚æ•°ï¼š

```python
server = start_server(host="0.0.0.0", port=9000)
```

### Q: ä»»åŠ¡æ•°é‡å¤ªå¤šæ€ä¹ˆåŠï¼Ÿ

**A:** ä½¿ç”¨è¿‡æ»¤æŒ‰é’®ç­›é€‰ç‰¹å®šçŠ¶æ€çš„ä»»åŠ¡ï¼Œæˆ–è€…åªå…³æ³¨ç»Ÿè®¡é¢æ¿ã€‚

### Q: å¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªæ•°æ®åŠ è½½å™¨å—ï¼Ÿ

**A:** å¯ä»¥ï¼TaskBoard æ˜¯å•ä¾‹æ¨¡å¼ï¼Œæ‰€æœ‰ DataLoader çš„ä»»åŠ¡éƒ½ä¼šæ˜¾ç¤ºåœ¨åŒä¸€ä¸ªä»»åŠ¡æ¿ä¸Šã€‚

## æŠ€æœ¯ç»†èŠ‚

- **åç«¯**ï¼šFastAPI + WebSocket
- **å‰ç«¯**ï¼šåŸç”Ÿ HTML/CSS/JavaScript
- **é€šä¿¡**ï¼šå®æ—¶ WebSocket æ¨é€
- **çº¿ç¨‹å®‰å…¨**ï¼šæ‰€æœ‰æ“ä½œéƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„
- **è‡ªåŠ¨é‡è¿**ï¼šè¿æ¥æ–­å¼€åè‡ªåŠ¨é‡è¿

## ç¤ºä¾‹è¾“å‡º

è¿è¡Œæ¼”ç¤ºåï¼Œä½ ä¼šåœ¨ä»»åŠ¡æ¿ä¸Šçœ‹åˆ°ï¼š

```
ç»Ÿè®¡é¢æ¿:
- æ€»ä»»åŠ¡æ•°: 441
- å¾…å¤„ç†: 350
- è¿è¡Œä¸­: 40
- å·²å®Œæˆ: 45
- å¤±è´¥: 6

ä»»åŠ¡åˆ—è¡¨:
[è“è‰²è¾¹æ¡†] Load CO3D Subset 1/441
  çŠ¶æ€: running
  è¿›åº¦: â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘ 75/100 (75.0%)
  ID: load_task_0
  å¼€å§‹æ—¶é—´: 14:35:20

[ç»¿è‰²è¾¹æ¡†] Load CO3D Subset 2/441
  çŠ¶æ€: completed
  è¿›åº¦: â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“ 150/150 (100.0%)
  ID: load_task_1
  å¼€å§‹æ—¶é—´: 14:35:18
  ç»“æŸæ—¶é—´: 14:35:45

...
```

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹ [ä»»åŠ¡æ¿æ¨¡å—æ–‡æ¡£](rot_data/taskboard/README.md) äº†è§£æ›´å¤š API ç»†èŠ‚
- æŸ¥çœ‹ [ç¤ºä¾‹ä»£ç ](examples/) äº†è§£æ›´å¤šä½¿ç”¨åœºæ™¯
- æ ¹æ®ä½ çš„éœ€æ±‚å®šåˆ¶ä»»åŠ¡æ¿åŠŸèƒ½

